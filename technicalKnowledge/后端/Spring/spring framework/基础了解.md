# 概述

> 版本 5.3.25

Spring 于 2003 年应运而生，以应对早期 [J2EE](https://en.wikipedia.org/wiki/Java_Platform,_Enterprise_Edition)规范的复杂性。Spring 是 Java EE 的补充。Spring 编程模型不包含 Java EE 平台规范；相反，它集成了从 EE 伞中精心挑选的个别规范：

- 小服务程序 API ( [JSR 340](https://jcp.org/en/jsr/detail?id=340) )
- WebSocket API ( [JSR 356](https://www.jcp.org/en/jsr/detail?id=356) )
- 并发实用程序 ( [JSR 236](https://www.jcp.org/en/jsr/detail?id=236) )
- JSON 绑定 API ( [JSR 367](https://jcp.org/en/jsr/detail?id=367) )
- Bean 验证（[JSR 303](https://jcp.org/en/jsr/detail?id=303)）
- 联合行动计划 ( [JSR 338](https://jcp.org/en/jsr/detail?id=338) )
- JMS（[JSR 914](https://jcp.org/en/jsr/detail?id=914)）
- 以及用于事务协调的 JTA/JCA 设置（如有必要）。

Spring Framework 分为模块。应用程序可以选择他们需要的模块。核心是核心容器的模块，包括配置模型和依赖注入机制。除此之外，Spring Framework 还为不同的应用程序架构提供基础支持，包括消息传递、事务数据和持久性以及 Web。它还包括基于 Servlet 的 Spring MVC Web 框架，以及并行的 Spring WebFlux 反应式 Web 框架。

# 核心技术

Spring 框架绝对不可或缺的所有技术。其中最重要的是 Spring 框架的控制反转 (IoC) 容器。在全面介绍 Spring Framework 的 IoC 容器之后，将全面介绍 Spring 的面向方面编程 (AOP) 技术。

## IoC 容器

### Spring IoC容器和Bean介绍

IoC 也称为依赖注入 (DI)。在这个过程中，对象仅通过构造函数参数、工厂方法的参数或在对象实例被构造或从工厂方法返回后设置的属性来定义它们的依赖关系（即它们使用的其他对象） . 然后容器在创建 bean 时注入这些依赖项。这个过程基本上是 bean 本身的逆过程（因此得名，控制反转），它通过使用类的直接构造或服务定位器模式等机制来控制其依赖项的实例化或位置。

`org.springframework.beans`和`org.springframework.context`包是 Spring Framework 的 IoC 容器的基础。该 [`BeanFactory`](https://docs.spring.io/spring-framework/docs/5.3.25/javadoc-api/org/springframework/beans/factory/BeanFactory.html) 接口提供了一种高级配置机制，能够管理任何类型的对象。 [`ApplicationContext`](https://docs.spring.io/spring-framework/docs/5.3.25/javadoc-api/org/springframework/context/ApplicationContext.html) 是 的子接口`BeanFactory`。它补充说：

- 更容易与 Spring 的 AOP 特性集成
- 消息资源处理（用于国际化）
- 活动发布
- 应用层特定的上下文，例如`WebApplicationContext` 用于 Web 应用程序的。

`BeanFactory`提供了配置框架和基本功能，并`ApplicationContext`添加了更多企业特定的功能。是的 `ApplicationContext`完整超集。

在 Spring 中，构成应用程序主干并由 Spring IoC 容器管理的对象称为 bean。bean 是由 Spring IoC 容器实例化、组装和管理的对象。否则，bean 只是应用程序中众多对象中的一个。Bean 以及它们之间的依赖关系反映在容器使用的配置元数据中。

### 容器概述

`org.springframework.context.ApplicationContext`接口表示 Spring IoC 容器，负责实例化、配置和组装 bean。容器通过读取配置元数据获取有关要实例化、配置和组装哪些对象的指令。配置元数据以 XML、Java 注释或 Java 代码表示。它允许您表达组成应用程序的对象以及这些对象之间丰富的相互依赖关系。

`ApplicationContext`Spring 提供了该接口的多个实现。在独立应用程序中，通常创建 [`ClassPathXmlApplicationContext`](https://docs.spring.io/spring-framework/docs/5.3.25/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html) 或的实例[`FileSystemXmlApplicationContext`](https://docs.spring.io/spring-framework/docs/5.3.25/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html)。虽然 XML 一直是定义配置元数据的传统格式，但您可以通过提供少量 XML 配置以声明方式启用对这些额外元数据格式的支持，从而指示容器使用 Java 注释或代码作为元数据格式。

Spring 工作原理的高级视图：

![容器魔法](Spring 工作原理的高级视图.png)

#### 配置元数据

Spring IoC 容器使用一种形式的配置元数据。此配置元数据表示您作为应用程序开发人员如何告诉 Spring 容器在您的应用程序中实例化、配置和组装对象。

- [基于注解的配置](https://docs.spring.io/spring-framework/docs/5.3.25/reference/html/core.html#beans-annotation-config)：Spring 2.5 引入了对基于注解的配置元数据的支持。
- [基于 Java 的配置](https://docs.spring.io/spring-framework/docs/5.3.25/reference/html/core.html#beans-java)：从 Spring 3.0 开始，Spring JavaConfig 项目提供的许多特性成为核心 Spring Framework 的一部分。因此，您可以使用 Java 而不是 XML 文件来定义应用程序类外部的 bean。

Spring 配置包含至少一个且通常不止一个容器必须管理的 bean 定义。基于 XML 的配置元数据将这些 bean 配置为`<bean/>`顶级元素中的`<beans/>`元素。Java 配置通常`@Bean`在类中使用带注释的方法`@Configuration`。

这些 bean 定义对应于构成您的应用程序的实际对象。通常，您定义服务层对象、数据访问对象 (DAO)、表示对象（如 Struts`Action`实例）、基础结构对象（如 Hibernate `SessionFactories`、JMS`Queues`等）。通常，不会在容器中配置细粒度的域对象，因为创建和加载域对象通常是 DAO 和业务逻辑的责任。

#### 实例化容器

提供给构造函数的位置路径或路径`ApplicationContext`是资源字符串，让容器从各种外部资源（如本地文件系统、Java 等）加载配置元数据`CLASSPATH`。

```java
ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");
```

#### 使用容器

这`ApplicationContext`是高级工厂的接口，能够维护不同 bean 及其依赖项的注册表。通过使用 方法 `T getBean(String name, Class<T> requiredType)`，您可以检索 bean 的实例。

允许您读取 bean 定义并访问它们，如以下`ApplicationContext`示例所示：

```java
// create and configure beans
ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");

// retrieve configured instance
PetStoreService service = context.getBean("petStore", PetStoreService.class);

// use configured instance
List<String> userList = service.getUsernameList();
```

### Bean 概述

一个 Spring IoC 容器管理一个或多个 bean。这些 bean 是使用您提供给容器的配置元数据创建的（例如，以 XML `<bean/>`定义的形式）。在容器本身中，这些 bean 定义表示为`BeanDefinition` 对象，其中包含（除其他信息外）以下元数据：

- 包限定的类名：通常是被定义的 bean 的实际实现类。
- Bean 行为配置元素，说明 bean 在容器中的行为方式（作用域、生命周期回调等）。
- 对 bean 完成其工作所需的其他 bean 的引用。这些引用也称为协作者或依赖项。
- 在新创建的对象中设置的其他配置设置——例如，池的大小限制或管理连接池的 bean 中使用的连接数。

此元数据转换为构成每个 bean 定义的一组属性。下表描述了这些属性：

| 属性                     | 描述                     |
| :----------------------- | :----------------------- |
| Class                    | Instantiating Beans      |
| Name                     | Naming Beans             |
| Scope                    | Bean Scopes              |
| Constructor arguments    | Dependency Injection     |
| Properties               | Dependency Injection     |
| Autowiring mode          | Autowiring Collaborators |
| Lazy initialization mode | Lazy-initialized Beans   |
| Initialization method    | Initialization Callbacks |
| Destruction method       | Destruction Callbacks    |

除了包含有关如何创建特定 bean 的信息的 bean 定义之外，这些`ApplicationContext`实现还允许注册在容器外部（由用户）创建的现有对象。这是通过返回实现`BeanFactory`的方法访问 ApplicationContext 来完成的。通过和 方法支持这种注册。但是，典型的应用程序仅使用通过常规 bean 定义元数据定义的 beans。getBeanFactory()``DefaultListableBeanFactory``DefaultListableBeanFactory``registerSingleton(..)``registerBeanDefinition(..)

#### Bean的命名

每个 bean 都有一个或多个标识符。这些标识符在托管 bean 的容器中必须是唯一的。一个 bean 通常只有一个标识符。但是，如果需要多个，则多出的可以视为别名。

在基于 XML 的配置元数据中，您使用`id`attribute、`name`attribute 或两者来指定 bean 标识符。该`id`属性使您可以准确指定一个 ID。通常，这些名称是字母数字（“myBean”、“someService”等），但它们也可以包含特殊字符。如果你想为bean引入其他别名，你也可以在`name` 属性中指定它们，用逗号（`,`）、分号（`;`）或空格分隔。

您不需要为 bean 提供 a`name`或 an `id`。如果您没有明确提供 a `name`或`id`，容器会为该 bean 生成一个唯一的名称。但是，如果您想通过名称引用该 bean，通过使用`ref`元素或服务定位器样式查找，您必须提供一个名称。不提供名称的动机与使用[内部 bean](https://docs.spring.io/spring-framework/docs/5.3.25/reference/html/core.html#beans-inner-beans)和[自动装配协作](https://docs.spring.io/spring-framework/docs/5.3.25/reference/html/core.html#beans-factory-autowire)器有关。

> Bean 命名约定
>
> 约定是在命名 bean 时使用标准 Java 约定作为实例字段名称。也就是说，bean 名称以小写字母开头，并从那里开始使用驼峰式大小写。此类名称的示例包括`accountManager`、 `accountService`、`userDao`、`loginController`等。
>
> 一致地命名 bean 使您的配置更易于阅读和理解。此外，如果您使用 Spring AOP，那么在将建议应用于一组按名称相关的 bean 时，它会大有帮助。

####  Bean 添加别名

在 bean 定义本身中，您可以为 bean 提供多个名称，方法是使用属性指定的最多一个名称`id`和属性中任意数量的其他名称的组合`name`。这些名称可以是同一个 bean 的等效别名，并且在某些情况下很有用，例如让应用程序中的每个组件通过使用特定于该组件本身的 bean 名称来引用公共依赖项。

但是，指定实际定义 bean 的所有别名并不总是足够的。有时需要为别处定义的 bean 引入别名。这在大型系统中很常见，其中配置在每个子系统之间拆分，每个子系统都有自己的一组对象定义。在基于 XML 的配置元数据中，您可以使用`<alias/>`元素来完成此操作。以下示例显示了如何执行此操作：

```xml
<alias name="fromName" alias="toName"/>
```

在这种情况下，在使用此别名定义后，命名的 bean（在同一容器中）`fromName`也可以称为`toName`.

#### 实例化 Bean

bean 定义本质上是创建一个或多个对象的方法。容器在被询问时查看命名 bean 的配方，并使用该 bean 定义封装的配置元数据来创建（或获取）实际对象。如果使用基于 XML 的配置元数据，则可以在元素的`class`属性中指定要实例化的对象的类型（或类）。`<bean/>`该 `class`属性（在内部是实例的`Class`属性`BeanDefinition` ）通常是必需的。

- 通常，在容器本身通过反射调用其构造函数直接创建bean 的情况下指定要构造的bean 类，有点类似于带有`new`运算符的Java 代码。
- `static`指定包含被调用来创建对象 的工厂方法的实际类，在不太常见的情况下，容器调用`static`类上的工厂方法来创建 bean。调用`static`工厂方法返回的对象类型可能是同一个类，也可能完全是另一个类。

> 嵌套类名
>
> 如果要为嵌套类配置 bean 定义，可以使用嵌套类的二进制名称或源名称。
>
> 例如，如果您`SomeThing`在`com.example`包中有一个名为的类，并且`SomeThing`该类有一个`static`名为的嵌套类`OtherThing`，则它们可以用美元符号 ( `$`) 或点 ( `.`) 分隔。所以`class`bean 定义中属性的值将是`com.example.SomeThing$OtherThing`or `com.example.SomeThing.OtherThing`。

##### 构造函数实例化

https://docs.spring.io/spring-framework/docs/5.3.25/reference/html/core.html#beans-factory-class-ctor